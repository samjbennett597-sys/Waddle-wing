<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Waddle Wings Universe</title>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap");
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:#000;
      color:#fff;
      font-family:"Fredoka One",cursive;
      display:flex;justify-content:center;align-items:center;
      height:100vh;overflow:hidden;
    }
    #game-wrap{
      position:relative;
      max-width:480px;max-height:800px;
      width:100%;height:100%;
      background:#000;border-radius:18px;
      overflow:hidden;box-shadow:0 0 25px rgba(0,0,0,.7);
    }
    canvas{display:block}

    /* HUD */
    #hud{
      pointer-events:none;
      position:absolute;inset:0;
    }
    #hud-top{
      display:flex;justify-content:space-between;align-items:center;
      padding:6px 10px;font-size:.9rem;text-shadow:0 2px 4px rgba(0,0,0,.6);
    }
    #score{font-size:2rem}
    #meta{text-align:right;font-size:.8rem}
    #coins,#lives{margin-left:2px}

    /* HUB MENU */
    #menu{
      pointer-events:auto;
      position:absolute;left:50%;top:50%;
      transform:translate(-50%,-50%);
      width:92%;max-width:420px;
      background:rgba(10,18,32,.94);
      border-radius:20px;border:2px solid rgba(255,255,255,.12);
      box-shadow:0 12px 25px rgba(0,0,0,.9);
      padding:14px 14px 10px;
      text-align:center;
    }
    #menu-title{
      font-size:1.3rem;letter-spacing:1px;margin-bottom:2px;
    }
    #menu-sub{font-size:.75rem;color:#ddd;margin-bottom:10px;}
    #menu-centre{
      margin:8px auto 12px;
      width:90%;max-width:360px;
      height:150px;border-radius:18px;
      border:2px solid rgba(255,255,255,.12);
      background:radial-gradient(circle at 50% 10%,rgba(255,255,255,.3),rgba(10,18,32,.95));
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      position:relative;overflow:hidden;
    }
    #menu-skin-name{margin-top:6px;font-size:.9rem}
    #menu-pod-canvas{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);}

    #menu-main-buttons{
      display:flex;gap:10px;justify-content:center;margin-bottom:8px;
    }
    .btn-main{
      flex:1;
      border:none;border-radius:999px;
      padding:10px 0;font-size:1rem;
      color:#fff;cursor:pointer;
      box-shadow:0 5px 0 rgba(0,0,0,.6);
    }
    #btn-play{background:linear-gradient(180deg,#ff7676,#ff5252);box-shadow:0 5px 0 #c04444;}
    #btn-store{background:linear-gradient(180deg,#6078ea,#364fc7);box-shadow:0 5px 0 #243369;}
    .btn-main:active{transform:translateY(2px);box-shadow:0 2px 0 rgba(0,0,0,.6);}

    #menu-icons{
      display:flex;justify-content:center;gap:10px;
    }
    .icon-btn{
      width:40px;height:40px;
      border-radius:50%;border:none;
      background:rgba(255,255,255,.08);
      box-shadow:0 3px 0 rgba(0,0,0,.6);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;font-size:1.2rem;color:#fff;
    }
    .icon-btn:active{transform:translateY(2px);box-shadow:0 1px 0 rgba(0,0,0,.8);}

    /* PANELS */
    .overlay{
      position:absolute;inset:0;
      background:rgba(0,0,0,.65);
      display:flex;justify-content:center;align-items:center;
      pointer-events:auto;
    }
    .hidden{display:none!important;}
    .panel{
      width:92%;max-width:420px;
      background:rgba(8,12,26,.97);
      border-radius:18px;border:2px solid rgba(255,255,255,.15);
      box-shadow:0 12px 25px rgba(0,0,0,.9);
      padding:14px;font-size:.85rem;
    }
    .panel-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:6px;
    }
    .panel-title{font-size:1.05rem;}
    .panel-close{
      border:none;background:transparent;color:#fff;
      font-size:1.4rem;cursor:pointer;
    }
    .panel-body{max-height:260px;overflow-y:auto;}
    .panel-footer{text-align:right;margin-top:8px;}

    .list{list-style:none;}
    .list-item{
      display:flex;justify-content:space-between;align-items:center;
      padding:6px 0;border-bottom:1px solid rgba(255,255,255,.08);
    }
    .list-label span:first-child{font-size:.9rem;}
    .list-label span:last-child{font-size:.72rem;color:#aaa;}

    .tag{font-size:.7rem;color:#ccc;margin-right:6px;}

    .btn-small{
      border:none;border-radius:999px;
      padding:5px 12px;font-size:.78rem;
      background:#ff7676;color:#fff;
      cursor:pointer;box-shadow:0 3px 0 #c04444;
      min-width:72px;text-align:center;
    }
    .btn-small:active{transform:translateY(2px);box-shadow:0 1px 0 #c04444;}
    .btn-small.secondary{background:#6078ea;box-shadow:0 3px 0 #243369;}
    .btn-small.green{background:#4caf50;box-shadow:0 3px 0 #2e7d32;}
    .btn-small.ghost{
      background:rgba(255,255,255,.08);
      box-shadow:none;border:1px solid rgba(255,255,255,.25);
    }
    .section-label{
      margin:8px 0 2px;font-size:.72rem;
      text-transform:uppercase;letter-spacing:1px;color:#bbb;
    }

    /* Centre cards (game over, ad, purchase) */
    .card-centre{
      position:absolute;left:50%;top:50%;
      transform:translate(-50%,-50%);
      min-width:230px;max-width:320px;
      background:#fff;color:#222;
      border-radius:18px;border:3px solid #2c3e50;
      padding:18px 16px;text-align:center;
      box-shadow:0 12px 25px rgba(0,0,0,.8);
      pointer-events:auto;
    }
    .card-centre h1{font-size:1.5rem;margin-bottom:4px;}
    .card-centre p{font-size:.9rem;margin:4px 0;}

    #fake-progress{
      width:100%;height:8px;border-radius:999px;
      background:#eee;overflow:hidden;margin-top:8px;
    }
    #fake-bar{height:100%;width:0;background:linear-gradient(90deg,#ff6b6b,#ffd66b);}
    #fake-time{font-size:.8rem;margin-top:4px;color:#555;}
  </style>
</head>
<body>
<div id="game-wrap">
  <canvas id="game"></canvas>

  <!-- HUD -->
  <div id="hud">
    <div id="hud-top">
      <div id="score">0</div>
      <div id="meta">
        <div>üí∞ <span id="coins">0</span></div>
        <div>‚ô• <span id="lives">5</span></div>
      </div>
    </div>
  </div>

  <!-- HUB MENU -->
  <div id="menu">
    <div id="menu-title">WADDLE WINGS UNIVERSE</div>
    <div id="menu-sub">Tap to flap ‚Ä¢ Don‚Äôt choke ‚Ä¢ Spend coins badly</div>

    <div id="menu-centre">
      <canvas id="menu-pod-canvas" width="80" height="80"></canvas>
      <div id="menu-skin-name">Classic Penguin</div>
    </div>

    <div id="menu-main-buttons">
      <button id="btn-play" class="btn-main">PLAY</button>
      <button id="btn-store" class="btn-main">STORE</button>
    </div>

    <div id="menu-icons">
      <button class="icon-btn" id="icon-modes" title="Modes">üïπ</button>
      <button class="icon-btn" id="icon-skins" title="Skins">üé®</button>
      <button class="icon-btn" id="icon-maps" title="Maps">üó∫Ô∏è</button>
      <button class="icon-btn" id="icon-missions" title="Missions">‚≠ê</button>
      <button class="icon-btn" id="icon-daily" title="Daily reward">üéÅ</button>
      <button class="icon-btn" id="icon-settings" title="Settings">‚öôÔ∏è</button>
    </div>
  </div>

  <!-- GENERIC PANELS -->
  <div id="ov-skins"   class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Skins</span><button class="panel-close" data-close="ov-skins">√ó</button></div><div class="panel-body"><ul id="list-skins" class="list"></ul></div><div class="panel-footer"><button class="btn-small ghost" data-close="ov-skins">Close</button></div></div></div>
  <div id="ov-maps"    class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Maps</span><button class="panel-close" data-close="ov-maps">√ó</button></div><div class="panel-body"><ul id="list-maps" class="list"></ul></div><div class="panel-footer"><button class="btn-small ghost" data-close="ov-maps">Close</button></div></div></div>
  <div id="ov-modes"   class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Modes</span><button class="panel-close" data-close="ov-modes">√ó</button></div><div class="panel-body"><ul id="list-modes" class="list"></ul></div><div class="panel-footer"><button class="btn-small ghost" data-close="ov-modes">Close</button></div></div></div>
  <div id="ov-missions"class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Missions</span><button class="panel-close" data-close="ov-missions">√ó</button></div><div class="panel-body"><ul id="list-missions" class="list"></ul></div><div class="panel-footer"><button class="btn-small ghost" data-close="ov-missions">Close</button></div></div></div>
  <div id="ov-daily"   class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Daily Reward</span><button class="panel-close" data-close="ov-daily">√ó</button></div><div class="panel-body"><p id="daily-text"></p></div><div class="panel-footer"><button id="btn-claim-daily" class="btn-small">Claim</button><button class="btn-small ghost" data-close="ov-daily">Close</button></div></div></div>
  <div id="ov-settings"class="overlay hidden"><div class="panel"><div class="panel-header"><span class="panel-title">Settings</span><button class="panel-close" data-close="ov-settings">√ó</button></div><div class="panel-body"><ul class="list"><li class="list-item"><div class="list-label"><span>Music</span><span>Background music</span></div><button id="btn-music" class="btn-small">Toggle</button></li><li class="list-item"><div class="list-label"><span>Sound FX</span><span>Flap, coin, hit</span></div><button id="btn-sfx" class="btn-small">Toggle</button></li><li class="list-item"><div class="list-label"><span>Vibration</span><span>On hits and purchases</span></div><button id="btn-vib" class="btn-small">Toggle</button></li></ul><p id="audio-status" style="margin-top:6px;font-size:.75rem;color:#ccc;"></p></div><div class="panel-footer"><button class="btn-small ghost" data-close="ov-settings">Close</button></div></div></div>

  <!-- STORE -->
  <div id="ov-store" class="overlay hidden">
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Store</span>
        <button class="panel-close" data-close="ov-store">√ó</button>
      </div>
      <div class="panel-body">
        <div class="section-label">Cosmetics</div>
        <ul id="store-cosmetics" class="list"></ul>

        <div class="section-label">Premium</div>
        <ul id="store-premium" class="list"></ul>

        <div class="section-label">Coin Packs</div>
        <ul id="store-coins" class="list"></ul>

        <div class="section-label">Account</div>
        <div class="list-item">
          <div class="list-label">
            <span>Reset progress</span>
            <span>Wipes coins, scores, ownership. Careful.</span>
          </div>
          <button id="btn-reset" class="btn-small ghost">Reset</button>
        </div>
        <div class="list-item">
          <div class="list-label">
            <span>Restore purchases</span>
            <span>Re-applies owned premium flags.</span>
          </div>
          <button id="btn-restore" class="btn-small secondary">Restore</button>
        </div>
      </div>
      <div class="panel-footer">
        <button class="btn-small ghost" data-close="ov-store">Close</button>
      </div>
    </div>
  </div>

  <!-- GAME OVER / NO LIVES / AD / PURCHASE UI -->
  <div id="card-over" class="card-centre hidden">
    <h1>OOF</h1>
    <p>Score: <span id="final-score">0</span></p>
    <p>Best: <span id="best-score">0</span></p>
    <p>Lives left: <span id="over-lives">0</span></p>
    <button id="btn-restart" class="btn-small" style="margin-top:6px;">Play again</button>
    <button id="btn-over-menu" class="btn-small ghost" style="margin-top:4px;">Back to menu</button>
  </div>

  <div id="card-nolives" class="card-centre hidden">
    <h1>No lives</h1>
    <p>You‚Äôre out of lives.</p>
    <p style="font-size:.8rem;">Lives regen 1 / hour or watch an ad for +1.</p>
    <button id="btn-watch-ad" class="btn-small">Watch ad</button>
    <button id="btn-nolives-menu" class="btn-small ghost" style="margin-top:4px;">Back to menu</button>
  </div>

  <div id="card-ad" class="card-centre hidden">
    <h1>Ad playing‚Ä¶</h1>
    <p style="font-size:.85rem;">Pretend this is a real game ad.</p>
    <div id="fake-progress"><div id="fake-bar"></div></div>
    <div id="fake-time">5s remaining</div>
  </div>

  <div id="card-confirm" class="card-centre hidden">
    <h1>Confirm</h1>
    <p id="confirm-text"></p>
    <button id="btn-confirm-yes" class="btn-small">Buy</button>
    <button id="btn-confirm-no" class="btn-small ghost" style="margin-top:4px;">Cancel</button>
  </div>

  <div id="card-success" class="card-centre hidden">
    <h1>Success</h1>
    <p id="success-text"></p>
    <button id="btn-success-ok" class="btn-small">OK</button>
  </div>
</div>

<script>
/* ---------- basic canvas sizing ---------- */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function sizeCanvas(){
  let w=Math.min(480,window.innerWidth);
  let h=Math.min(800,window.innerHeight);
  canvas.width=w;canvas.height=h;
}
window.addEventListener("resize",sizeCanvas);sizeCanvas();

/* ---------- data ---------- */
const GRAVITY=.25, FLAP=-5.5, MAX_LIVES=5, REGEN_MS=60*60*1000;
const SKINS=[
  {id:"classic",name:"Classic Penguin",body:"#2c3e50",wing:"#34495e",beak:"#ffb74d"},
  {id:"red",name:"Red Rebel",body:"#c0392b",wing:"#922b21",beak:"#ffb74d",cost:40},
  {id:"gold",name:"Golden Waddle",body:"#d4af37",wing:"#b08a2e",beak:"#ffe082",cost:100},
  {id:"neon",name:"Neon Cyber",body:"#00e5ff",wing:"#00b0ff",beak:"#ffeb3b",cost:120}
];
const MAPS=[
  {id:"day",name:"Snowfield Day",grad:["#99d9ff","#e6f7ff"],cost:0},
  {id:"night",name:"Polar Night",grad:["#001c3d","#00335c"],cost:40},
  {id:"storm",name:"Blizzard",grad:["#546e7a","#eceff1"],cost:60},
  {id:"synth",name:"Synthwave",grad:["#4a148c","#ff6f00"],cost:80}
];
const MODES=[
  {id:"easy",name:"Easy",desc:"Slow pipes, big gaps",speed:2.4,gap:190},
  {id:"normal",name:"Normal",desc:"Balanced",speed:3,gap:160},
  {id:"hard",name:"Hard",desc:"Fast, tight gaps",speed:3.6,gap:140},
  {id:"extreme",name:"Extreme",desc:"Chaos",speed:4.3,gap:120}
];
const MISSIONS=[
  {id:"m10",name:"First Steps",desc:"Score 10",type:"best",target:10,reward:20},
  {id:"m25",name:"Getting Good",desc:"Score 25",type:"best",target:25,reward:40},
  {id:"runs3",name:"Warming Up",desc:"Play 3 runs today",type:"runs",target:3,reward:15}
];
const PREMIUM=[
  {id:"ultra",name:"Unlimited Lives",desc:"Never run out again",price:"¬£19.99"},
  {id:"noads",name:"Remove Ads",desc:"No ads ever",price:"¬£4.99"},
  {id:"double",name:"Double Coins",desc:"All coin gains x2",price:"¬£4.99"},
  {id:"ultimate",name:"Ultimate Pack",desc:"All perks + bonus cosmetics",price:"¬£29.99"}
];
const COIN_PK=[
  {id:"c100",name:"Small Pack",desc:"+100 coins",amount:100,price:"¬£0.99"},
  {id:"c300",name:"Medium Pack",desc:"+300 coins",amount:300,price:"¬£2.49"},
  {id:"c800",name:"Big Pack",desc:"+800 coins",amount:800,price:"¬£4.99"}
];

function num(key,def=0){const v=parseInt(localStorage.getItem(key)??def,10);return isNaN(v)?def:v;}
function bool(key){return localStorage.getItem(key)==="true";}
let coins=num("ww_coins");
let lives=num("ww_lives",MAX_LIVES);
let lastLife=num("ww_lastLife",Date.now());
let highScore=num("ww_high",0);
let musicOn=localStorage.getItem("ww_music")??"true";
let sfxOn=localStorage.getItem("ww_sfx")??"true";
let vibOn=localStorage.getItem("ww_vib")??"true";
let ownedSkins=JSON.parse(localStorage.getItem("ww_skins")||'["classic"]');
let ownedMaps=JSON.parse(localStorage.getItem("ww_maps")||'["day"]');
let skinId=localStorage.getItem("ww_skin")||"classic";
let mapId=localStorage.getItem("ww_map")||"day";
let modeId=localStorage.getItem("ww_mode")||"normal";
let lastDaily=localStorage.getItem("ww_daily")||"";
let runsTodayDate=localStorage.getItem("ww_runsDate")||"";
let runsToday=num("ww_runs",0);
let missionState=JSON.parse(localStorage.getItem("ww_missions")||"{}");
let p_ultra=bool("ww_p_ultra"),p_noads=bool("ww_p_noads"),
    p_double=bool("ww_p_double"),p_ultimate=bool("ww_p_ultimate");

/* ---------- helpers ---------- */
const scoreEl=document.getElementById("score"),
      coinsEl=document.getElementById("coins"),
      livesEl=document.getElementById("lives"),
      menu=document.getElementById("menu"),
      podCanvas=document.getElementById("menu-pod-canvas"),
      podCtx=podCanvas.getContext("2d"),
      podSkinName=document.getElementById("menu-skin-name");

function today(){return new Date().toISOString().slice(0,10);}
function saveMeta(){
  localStorage.setItem("ww_coins",coins);
  localStorage.setItem("ww_lives",lives);
  localStorage.setItem("ww_lastLife",lastLife);
  localStorage.setItem("ww_high",highScore);
  localStorage.setItem("ww_music",musicOn);
  localStorage.setItem("ww_sfx",sfxOn);
  localStorage.setItem("ww_vib",vibOn);
  localStorage.setItem("ww_skins",JSON.stringify(ownedSkins));
  localStorage.setItem("ww_maps",JSON.stringify(ownedMaps));
  localStorage.setItem("ww_skin",skinId);
  localStorage.setItem("ww_map",mapId);
  localStorage.setItem("ww_mode",modeId);
  localStorage.setItem("ww_daily",lastDaily);
  localStorage.setItem("ww_runsDate",runsTodayDate);
  localStorage.setItem("ww_runs",runsToday);
  localStorage.setItem("ww_missions",JSON.stringify(missionState));
  localStorage.setItem("ww_p_ultra",p_ultra);
  localStorage.setItem("ww_p_noads",p_noads);
  localStorage.setItem("ww_p_double",p_double);
  localStorage.setItem("ww_p_ultimate",p_ultimate);
}
function updateTop(){
  coinsEl.textContent=coins;
  livesEl.textContent=p_ultra||p_ultimate?"‚àû":lives;
}
function vib(ms){if(vibOn==="true"&&"vibrate" in navigator)navigator.vibrate(ms);}
function skinObj(){return SKINS.find(s=>s.id===skinId)||SKINS[0];}
function mapObj(){return MAPS.find(m=>m.id===mapId)||MAPS[0];}
function modeObj(){return MODES.find(m=>m.id===modeId)||MODES[1];}

/* ---------- lives regen ---------- */
function regen(){
  if(p_ultra||p_ultimate){lives=MAX_LIVES;lastLife=Date.now();saveMeta();updateTop();return;}
  if(lives>=MAX_LIVES)return;
  const now=Date.now(),elapsed=now-lastLife;
  const gained=Math.floor(elapsed/REGEN_MS);
  if(gained>0){
    lives=Math.min(MAX_LIVES,lives+gained);
    lastLife=now;
    saveMeta();updateTop();
  }
}
regen();setInterval(regen,30000);

/* ---------- menu skin drawing ---------- */
function drawPod(){
  const s=skinObj();
  podCtx.clearRect(0,0,podCanvas.width,podCanvas.height);
  podCtx.save();podCtx.translate(podCanvas.width/2,podCanvas.height/2+4);
  podCtx.fillStyle=s.body;podCtx.beginPath();podCtx.ellipse(0,0,18,24,0,0,Math.PI*2);podCtx.fill();
  podCtx.fillStyle="#fff";podCtx.beginPath();podCtx.ellipse(-1,2,13,18,0,0,Math.PI*2);podCtx.fill();
  podCtx.fillStyle="#fff";podCtx.beginPath();podCtx.arc(6,-7,5,0,Math.PI*2);podCtx.fill();
  podCtx.fillStyle="#000";podCtx.beginPath();podCtx.arc(7,-7,2,0,Math.PI*2);podCtx.fill();
  podCtx.fillStyle=s.beak;podCtx.beginPath();podCtx.moveTo(9,-1);podCtx.lineTo(18,2);podCtx.lineTo(9,5);podCtx.fill();
  podCtx.fillStyle=s.wing;podCtx.beginPath();podCtx.ellipse(-5,5,8,14,-.5,0,Math.PI*2);podCtx.fill();
  podCtx.restore();
  podSkinName.textContent=s.name;
}
drawPod();updateTop();

/* ---------- missions ---------- */
function missionProgress(m){
  if(m.type==="best")return {cur:highScore};
  if(m.type==="runs")return {cur:runsToday};
  return{cur:0};
}
function checkMissions(){
  MISSIONS.forEach(m=>{
    const st=missionState[m.id]||{done:false,claimed:false};
    if(st.done)return;
    const prog=missionProgress(m);
    if(prog.cur>=m.target){st.done=true;missionState[m.id]=st;}
  });
}

/* ---------- overlay helpers ---------- */
function show(id){document.getElementById(id).classList.remove("hidden");}
function hide(id){document.getElementById(id).classList.add("hidden");}
document.querySelectorAll("[data-close]").forEach(btn=>{
  btn.addEventListener("click",()=>hide(btn.dataset.close));
});

/* ---------- lists ---------- */
function renderSkinsPanel(){
  const ul=document.getElementById("list-skins");ul.innerHTML="";
  SKINS.forEach(s=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    const t=document.createElement("span");t.textContent=s.name;
    const d=document.createElement("span");
    const owned=ownedSkins.includes(s.id);
    d.textContent=owned?(s.id===skinId?"Equipped":"Owned"):`Cost: ${s.cost||0} coins`;
    lab.append(t,d);
    const btn=document.createElement("button");btn.className="btn-small";
    if(!owned && s.cost>0){
      btn.textContent=`Buy`;
      btn.onclick=()=>{
        if(coins<s.cost)return alert("Not enough coins");
        coins-=s.cost;ownedSkins.push(s.id);skinId=s.id;saveMeta();updateTop();drawPod();renderSkinsPanel();renderStoreCosmetics();
      };
    }else{
      if(s.id===skinId){btn.textContent="Equipped";btn.classList.add("green");btn.disabled=true;}
      else{btn.textContent="Equip";btn.onclick=()=>{skinId=s.id;saveMeta();drawPod();renderSkinsPanel();};}
    }
    li.append(lab,btn);ul.appendChild(li);
  });
}
function renderMapsPanel(){
  const ul=document.getElementById("list-maps");ul.innerHTML="";
  MAPS.forEach(m=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    const t=document.createElement("span");t.textContent=m.name;
    const d=document.createElement("span");
    const owned=ownedMaps.includes(m.id);
    d.textContent=owned?(m.id===mapId?"Equipped":"Owned"):`Cost: ${m.cost||0} coins`;
    lab.append(t,d);
    const btn=document.createElement("button");btn.className="btn-small";
    if(!owned && m.cost>0){
      btn.textContent="Buy";
      btn.onclick=()=>{
        if(coins<m.cost)return alert("Not enough coins");
        coins-=m.cost;ownedMaps.push(m.id);mapId=m.id;saveMeta();updateTop();renderMapsPanel();renderStoreCosmetics();
      };
    }else{
      if(m.id===mapId){btn.textContent="Equipped";btn.classList.add("green");btn.disabled=true;}
      else{btn.textContent="Equip";btn.onclick=()=>{mapId=m.id;saveMeta();renderMapsPanel();};}
    }
    li.append(lab,btn);ul.appendChild(li);
  });
}
function renderModesPanel(){
  const ul=document.getElementById("list-modes");ul.innerHTML="";
  MODES.forEach(m=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    lab.innerHTML=`<span>${m.name}</span><span>${m.desc}</span>`;
    const btn=document.createElement("button");btn.className="btn-small";
    if(m.id===modeId){btn.textContent="Selected";btn.classList.add("green");btn.disabled=true;}
    else{btn.textContent="Set";btn.onclick=()=>{modeId=m.id;saveMeta();renderModesPanel();};}
    li.append(lab,btn);ul.appendChild(li);
  });
}
function renderMissionsPanel(){
  const ul=document.getElementById("list-missions");ul.innerHTML="";
  MISSIONS.forEach(m=>{
    const st=missionState[m.id]||{done:false,claimed:false};
    const prog=missionProgress(m);
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    const t=document.createElement("span");t.textContent=m.name;
    const d=document.createElement("span");
    d.textContent=`${m.desc} ‚Ä¢ ${prog.cur}/${m.target} ‚Ä¢ +${m.reward} coins`;
    lab.append(t,d);
    const right=document.createElement("div");
    const tag=document.createElement("span");tag.className="tag";
    tag.textContent=!st.done?"In progress":st.claimed?"Claimed":"Ready";
    right.appendChild(tag);
    if(st.done && !st.claimed){
      const btn=document.createElement("button");btn.className="btn-small";
      btn.textContent="Claim";
      btn.onclick=()=>{
        let r=m.reward;if(p_double||p_ultimate)r*=2;
        coins+=r;st.claimed=true;missionState[m.id]=st;saveMeta();updateTop();renderMissionsPanel();
      };
      right.appendChild(btn);
    }
    li.append(lab,right);ul.appendChild(li);
  });
}

/* store lists */
const storeCos=document.getElementById("store-cosmetics"),
      storePrem=document.getElementById("store-premium"),
      storeCoins=document.getElementById("store-coins"),
      cardConfirm=document.getElementById("card-confirm"),
      confirmText=document.getElementById("confirm-text"),
      cardSuccess=document.getElementById("card-success"),
      successText=document.getElementById("success-text");
let pendingPurchase=null;
function openConfirm(label,onOk){
  pendingPurchase=onOk;confirmText.textContent=label;showCard(cardConfirm);
}
function showCard(el){el.classList.remove("hidden");}
function hideCard(el){el.classList.add("hidden");}
document.getElementById("btn-confirm-no").onclick=()=>hideCard(cardConfirm);
document.getElementById("btn-confirm-yes").onclick=()=>{
  hideCard(cardConfirm);
  if(pendingPurchase)pendingPurchase();
};

document.getElementById("btn-success-ok").onclick=()=>hideCard(cardSuccess);

function renderStoreCosmetics(){
  storeCos.innerHTML="";
  SKINS.forEach(s=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    const owned=ownedSkins.includes(s.id);
    lab.innerHTML=`<span>[Skin] ${s.name}</span><span>${owned?(s.id===skinId?"Equipped":"Owned"):`Cost ${s.cost||0} coins`}</span>`;
    const btn=document.createElement("button");btn.className="btn-small";
    if(!owned && s.cost>0){
      btn.textContent="Buy";
      btn.onclick=()=>{
        if(coins<s.cost)return alert("Not enough coins");
        coins-=s.cost;ownedSkins.push(s.id);skinId=s.id;saveMeta();updateTop();drawPod();renderStoreCosmetics();renderSkinsPanel();
      };
    }else{
      if(s.id===skinId){btn.textContent="Equipped";btn.classList.add("green");btn.disabled=true;}
      else{btn.textContent="Equip";btn.onclick=()=>{skinId=s.id;saveMeta();drawPod();renderStoreCosmetics();};}
    }
    li.append(lab,btn);storeCos.appendChild(li);
  });
  MAPS.forEach(m=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    const owned=ownedMaps.includes(m.id);
    lab.innerHTML=`<span>[Map] ${m.name}</span><span>${owned?(m.id===mapId?"Equipped":"Owned"):`Cost ${m.cost||0} coins`}</span>`;
    const btn=document.createElement("button");btn.className="btn-small";
    if(!owned && m.cost>0){
      btn.textContent="Buy";
      btn.onclick=()=>{
        if(coins<m.cost)return alert("Not enough coins");
        coins-=m.cost;ownedMaps.push(m.id);mapId=m.id;saveMeta();updateTop();renderStoreCosmetics();renderMapsPanel();
      };
    }else{
      if(m.id===mapId){btn.textContent="Equipped";btn.classList.add("green");btn.disabled=true;}
      else{btn.textContent="Equip";btn.onclick=()=>{mapId=m.id;saveMeta();renderStoreCosmetics();};}
    }
    li.append(lab,btn);storeCos.appendChild(li);
  });
}
function renderStorePremium(){
  storePrem.innerHTML="";
  PREMIUM.forEach(p=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    lab.innerHTML=`<span>${p.name}</span><span>${p.desc} ‚Ä¢ ${p.price}</span>`;
    const btn=document.createElement("button");btn.className="btn-small";
    let owned=false;
    if(p.id==="ultra")owned=p_ultra;
    if(p.id==="noads")owned=p_noads;
    if(p.id==="double")owned=p_double;
    if(p.id==="ultimate")owned=p_ultimate;
    if(owned){btn.textContent="Owned";btn.classList.add("green");btn.disabled=true;}
    else{
      btn.textContent=p.price;
      btn.onclick=()=>{
        openConfirm(`${p.name} ‚Äì ${p.price}`,()=>{
          if(p.id==="ultra")p_ultra=true;
          if(p.id==="noads")p_noads=true;
          if(p.id==="double")p_double=true;
          if(p.id==="ultimate"){p_ultimate=true;p_ultra=true;p_noads=true;p_double=true;
            if(!ownedSkins.includes("neon"))ownedSkins.push("neon");
            if(!ownedMaps.includes("synth"))ownedMaps.push("synth");
          }
          lives=MAX_LIVES;saveMeta();updateTop();renderStorePremium();renderStoreCosmetics();
          successText.textContent="Purchase successful";showCard(cardSuccess);
        });
      };
    }
    li.append(lab,btn);storePrem.appendChild(li);
  });
}
function renderStoreCoins(){
  storeCoins.innerHTML="";
  COIN_PK.forEach(p=>{
    const li=document.createElement("li");li.className="list-item";
    const lab=document.createElement("div");lab.className="list-label";
    lab.innerHTML=`<span>${p.name}</span><span>${p.desc} ‚Ä¢ ${p.price}</span>`;
    const btn=document.createElement("button");btn.className="btn-small";
    btn.textContent=p.price;
    btn.onclick=()=>{
      openConfirm(`${p.name} ‚Äì ${p.price}`,()=>{
        coins+=p.amount;saveMeta();updateTop();renderStoreCoins();
        successText.textContent=`Added ${p.amount} coins`;showCard(cardSuccess);
      });
    };
    li.append(lab,btn);storeCoins.appendChild(li);
  });
}

/* reset & restore */
document.getElementById("btn-reset").onclick=()=>{
  if(!confirm("Reset ALL progress?"))return;
  localStorage.clear();location.reload();
};
document.getElementById("btn-restore").onclick=()=>{
  // fake restore: just reapply premium from local (real app would query Google)
  successText.textContent="Purchases restored (demo).";showCard(cardSuccess);
};

/* ---------- daily ---------- */
const DAILY_COINS=20;
const dailyText=document.getElementById("daily-text"),
      btnDaily=document.getElementById("btn-claim-daily");
function updateDailyPanel(){
  const t=today();
  if(lastDaily===t){
    dailyText.textContent="Already claimed today. Come back tomorrow.";
    btnDaily.disabled=true;btnDaily.style.opacity=".5";
  }else{
    let r=DAILY_COINS;if(p_double||p_ultimate)r*=2;
    dailyText.textContent=`Tap claim for +${r} coins.`;
    btnDaily.disabled=false;btnDaily.style.opacity="1";
  }
}
btnDaily.onclick=()=>{
  const t=today();
  if(lastDaily===t)return;
  lastDaily=t;
  let r=DAILY_COINS;if(p_double||p_ultimate)r*=2;
  coins+=r;saveMeta();updateTop();updateDailyPanel();
};

/* ---------- audio flags (no actual audio wired in this compact build) ---------- */
const audioStatus=document.getElementById("audio-status");
function updateAudioStatus(){
  audioStatus.textContent=`Music: ${musicOn==="true"?"ON":"OFF"} | SFX: ${sfxOn==="true"?"ON":"OFF"} | Vibrate: ${vibOn==="true"?"ON":"OFF"}`;
}
document.getElementById("btn-music").onclick=()=>{musicOn=musicOn==="true"?"false":"true";saveMeta();updateAudioStatus();};
document.getElementById("btn-sfx").onclick=()=>{sfxOn=sfxOn==="true"?"false":"true";saveMeta();updateAudioStatus();};
document.getElementById("btn-vib").onclick=()=>{vibOn=vibOn==="true"?"false":"true";saveMeta();updateAudioStatus();};
updateAudioStatus();

/* ---------- game objects ---------- */
let frames=0,score=0,isRunning=false,started=false,isOver=false;
const snow=[];
function initSnow(){
  snow.length=0;
  for(let i=0;i<60;i++)
    snow.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+1,s:Math.random()*1+.3});
}
initSnow();

const player={
  x:canvas.width*.2,y:canvas.height/2,r:18,v:0,
  reset(){this.x=canvas.width*.2;this.y=canvas.height/2;this.v=0;},
  flap(){this.v=FLAP;},
  update(){
    this.v+=GRAVITY;this.y+=this.v;
    if(this.y+this.r>canvas.height){this.y=canvas.height-this.r;gameOver();}
    if(this.y-this.r<0){this.y=this.r;this.v=0;}
  },
  draw(){
    const s=skinObj();ctx.save();
    ctx.translate(this.x,this.y);ctx.rotate(Math.max(-Math.PI/4,Math.min(Math.PI/4,this.v*.1)));
    ctx.fillStyle=s.body;ctx.beginPath();ctx.ellipse(0,0,20,25,0,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#fff";ctx.beginPath();ctx.ellipse(-1,2,14,18,0,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(6,-8,6,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#000";ctx.beginPath();ctx.arc(8,-8,2,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=s.beak;ctx.beginPath();ctx.moveTo(10,-2);ctx.lineTo(22,2);ctx.lineTo(10,6);ctx.fill();
    ctx.fillStyle=s.wing;ctx.beginPath();ctx.ellipse(-5,5,8,14,-.5,0,Math.PI*2);ctx.fill();
    ctx.restore();
  }
};

const pipes=[];
function resetPipes(){pipes.length=0;}
function updatePipes(){
  const m=modeObj();
  if(frames%100===0){
    const min=60,max=canvas.height-m.gap-60;
    const topY=min+Math.random()*(max-min);
    pipes.push({x:canvas.width,y:topY,passed:false});
  }
  const w=60;
  for(let i=0;i<pipes.length;i++){
    const p=pipes[i];
    let speed=m.speed;
    if(score>=50)speed*=1.1;
    if(score>=100){speed*=1.25;p.y+=Math.sin(frames*.08+p.x*.02)*1.5;}
    p.x-=speed;
    const left=p.x,right=p.x+w;
    const gapTop=p.y,gapBot=p.y+m.gap;
    const px=player.x,py=player.y,r=player.r;
    if(px+r>left && px-r<right){
      if(py-r<gapTop || py+r>gapBot)gameOver();
    }
    if(!p.passed && p.x+w<player.x){
      p.passed=true;score++;let c=1;if(p_double||p_ultimate)c*=2;coins+=c;
      scoreEl.textContent=score;updateTop();saveMeta();
    }
    if(p.x+w<0){pipes.splice(i,1);i--;}
  }
}
function drawPipes(){
  const m=mapObj();const w=60;
  pipes.forEach(p=>{
    const g1=ctx.createLinearGradient(p.x,0,p.x+w,0);
    g1.addColorStop(0,m.grad[0]);g1.addColorStop(1,m.grad[1]);
    ctx.fillStyle=g1;ctx.fillRect(p.x,0,w,p.y);
    ctx.fillRect(p.x,p.y+m.gap,w,canvas.height-(p.y+m.gap));
  });
}
function drawBg(){
  const m=mapObj(),g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,m.grad[0]);g.addColorStop(1,m.grad[1]);
  ctx.fillStyle=g;ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="rgba(255,255,255,.75)";
  snow.forEach(f=>{
    ctx.beginPath();ctx.arc(f.x,f.y,f.r,0,Math.PI*2);ctx.fill();
    f.y+=f.s;f.x+=Math.sin((f.y+frames*.1))*0.2;
    if(f.y>canvas.height){f.y=-5;f.x=Math.random()*canvas.width;}
  });
}

/* ---------- main loop ---------- */
let lastTime=performance.now();
function loop(t){
  if(!isRunning){lastTime=t;return requestAnimationFrame(loop);}
  const dt=t-lastTime;lastTime=t;
  frames++;
  if(!started){
    player.y=canvas.height/2+Math.sin(frames*.08)*10;player.v=0;
  }else player.update();
  updatePipes();

  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBg();drawPipes();player.draw();

  if(!isOver)requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- game flow ---------- */
const cardOver=document.getElementById("card-over"),
      cardNoLives=document.getElementById("card-nolives"),
      finalScore=document.getElementById("final-score"),
      bestScore=document.getElementById("best-score"),
      overLives=document.getElementById("over-lives");

function startRun(){
  regen();updateTop();
  if(!p_ultra && !p_ultimate && lives<=0){
    showCard(cardNoLives);return;
  }
  menu.classList.add("hidden");
  cardOver.classList.add("hidden");
  cardNoLives.classList.add("hidden");
  score=0;scoreEl.textContent="0";
  frames=0;isOver=false;isRunning=true;started=false;
  player.reset();resetPipes();initSnow();
}
function gameOver(){
  if(isOver)return;
  isOver=true;isRunning=false;
  if(!p_ultra && !p_ultimate){
    lives=Math.max(0,lives-1);
  }
  lastLife=Date.now();
  runsTodayDate=today();
  if(today()!==runsTodayDate){runsTodayDate=today();runsToday=0;}
  runsToday++;
  if(score>highScore)highScore=score;
  checkMissions();
  saveMeta();updateTop();
  finalScore.textContent=score;
  bestScore.textContent=highScore;
  overLives.textContent=p_ultra||p_ultimate?"‚àû":lives;
  showCard(cardOver);
}

/* input */
function flapInput(e){
  if(e.type==="keydown" && e.code!=="Space")return;
  if(e.type==="keydown")e.preventDefault();
  if(!isRunning||isOver)return;
  if(!started)started=true;
  player.flap();
}
window.addEventListener("keydown",flapInput);
canvas.addEventListener("mousedown",flapInput);
canvas.addEventListener("touchstart",e=>{e.preventDefault();flapInput(e);},{passive:false});

/* buttons */
document.getElementById("btn-play").onclick=startRun;
document.getElementById("btn-store").onclick=()=>{
  renderStoreCosmetics();renderStorePremium();renderStoreCoins();show("ov-store");
};
document.getElementById("icon-skins").onclick=()=>{renderSkinsPanel();show("ov-skins");};
document.getElementById("icon-maps").onclick=()=>{renderMapsPanel();show("ov-maps");};
document.getElementById("icon-modes").onclick=()=>{renderModesPanel();show("ov-modes");};
document.getElementById("icon-missions").onclick=()=>{checkMissions();renderMissionsPanel();show("ov-missions");};
document.getElementById("icon-daily").onclick=()=>{updateDailyPanel();show("ov-daily");};
document.getElementById("icon-settings").onclick=()=>{updateAudioStatus();show("ov-settings");};

document.getElementById("btn-restart").onclick=()=>{
  if(!p_ultra && !p_ultimate && lives<=0){hideCard(cardOver);showCard(cardNoLives);}
  else{hideCard(cardOver);startRun();}
};
document.getElementById("btn-over-menu").onclick=()=>{
  hideCard(cardOver);menu.classList.remove("hidden");
};
document.getElementById("btn-nolives-menu").onclick=()=>{
  hideCard(cardNoLives);menu.classList.remove("hidden");
};

/* fake rewarded ad */
const cardAd=document.getElementById("card-ad"),
      fakeBar=document.getElementById("fake-bar"),
      fakeTime=document.getElementById("fake-time");
document.getElementById("btn-watch-ad").onclick=()=>{
  if(p_noads||p_ultimate){
    lives=Math.min(MAX_LIVES,lives+1);saveMeta();updateTop();
    alert("Ad-free bonus: +1 life");hideCard(cardNoLives);menu.classList.remove("hidden");
    return;
  }
  hideCard(cardNoLives);showCard(cardAd);
  let d=5,r=d;
  fakeBar.style.width="0%";fakeTime.textContent=`${r}s remaining`;
  const int=setInterval(()=>{
    r--;const pct=((d-r)/d)*100;fakeBar.style.width=pct+"%";
    fakeTime.textContent=`${Math.max(r,0)}s remaining`;
    if(r<=0){clearInterval(int);setTimeout(()=>{
      hideCard(cardAd);lives=Math.min(MAX_LIVES,lives+1);saveMeta();updateTop();
      alert("Thanks for watching! +1 life");menu.classList.remove("hidden");
    },300);}
  },1000);
};
</script>
</body>
</html>
