<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waddle Wings ‚Äì Arcade Edition</title>

<!-- 90s pixel font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  overflow:hidden;
  background:#000;
  font-family:"Press Start 2P", cursive;
  color:#fff;
}

/* -------------------- GAME CANVAS -------------------- */
#gameCanvas{
  display:block;
  margin:0 auto;
  background:#000;
}

/* -------------------- UI LAYER -------------------- */
#ui-layer{
  position:absolute;
  inset:0;
  pointer-events:none;
}

#top-icons{
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:12px;
  pointer-events:auto;
}

.icon-btn{
  width:38px;
  height:38px;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.55);
  border:2px solid #fff;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
}

#score{
  position:absolute;
  top:10px;
  left:10px;
  font-size:22px;
  text-shadow:0 0 5px #000;
}

/* -------------------- MAIN MENU -------------------- */
#main-menu{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.4);
  backdrop-filter:blur(3px);
  pointer-events:auto;
}

.menu-btn{
  width:70%;
  max-width:290px;
  padding:20px;
  margin:12px 0;
  text-align:center;
  font-size:20px;
  color:#fff;
  border:3px solid #fff;
  background:#000;
  cursor:pointer;
  letter-spacing:2px;
  text-shadow:0 0 6px #00f2ff;
}

.menu-btn:active{
  transform:scale(0.95);
}

/* small icon row under buttons */
#menu-icons{
  margin-top:20px;
  display:flex;
  gap:18px;
}

.small-icon{
  width:42px;
  height:42px;
  border:2px solid #fff;
  border-radius:10px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:20px;
  cursor:pointer;
}

/* -------------------- STORE PANEL -------------------- */
#store-panel{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  flex-direction:column;
  padding:20px;
  pointer-events:auto;
}

.store-title{
  text-align:center;
  font-size:18px;
  margin-bottom:20px;
}

.store-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 0;
  border-bottom:1px solid #444;
}

.toggle{
  width:55px;
  height:28px;
  border-radius:20px;
  background:#333;
  border:2px solid #777;
  position:relative;
  cursor:pointer;
}

.toggle-circle{
  position:absolute;
  top:2px;
  left:2px;
  width:22px;
  height:22px;
  border-radius:50%;
  background:#fff;
  transition:0.2s;
}

/* active = purchased + equipped */
.toggle.active{
  background:#00ff00;
  border-color:#00ff00;
}

.toggle.active .toggle-circle{
  left:29px;
}

#close-store{
  margin-top:20px;
  text-align:center;
  padding:10px;
  border:2px solid #fff;
  cursor:pointer;
}

/* -------------------- GAME OVER -------------------- */
#game-over{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.75);
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  pointer-events:auto;
  text-align:center;
}

#game-over button{
  width:60%;
  max-width:280px;
  padding:18px;
  margin:10px 0;
  font-family:"Press Start 2P";
  border:3px solid #fff;
  background:#000;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">

  <div id="score">0</div>

  <div id="top-icons">
    <div id="sound-btn" class="icon-btn">üîä</div>
    <div id="vibrate-btn" class="icon-btn">üì≥</div>
  </div>

</div>

<!-- -------------------- MENU -------------------- -->
<div id="main-menu">
  <div id="btn-play" class="menu-btn">PLAY</div>
  <div id="btn-store" class="menu-btn">STORE</div>

  <div id="menu-icons">
    <div id="btn-reset" class="small-icon">‚ôªÔ∏è</div>
    <div id="btn-restore" class="small-icon">üíæ</div>
    <div id="btn-settings" class="small-icon">‚öôÔ∏è</div>
  </div>
</div>

<!-- -------------------- STORE -------------------- -->
<div id="store-panel">
  <div class="store-title">STORE</div>

  <div class="store-item">
    <span>No Ads ‚Äì ¬£4.99</span>
    <div class="toggle" id="tog-noads"><div class="toggle-circle"></div></div>
  </div>

  <div class="store-item">
    <span>Unlimited Lives ‚Äì ¬£19.99</span>
    <div class="toggle" id="tog-ulives"><div class="toggle-circle"></div></div>
  </div>

  <div class="store-item">
    <span>Hard Mode Unlock ‚Äì ¬£1.99</span>
    <div class="toggle" id="tog-hard"><div class="toggle-circle"></div></div>
  </div>

  <div id="close-store">CLOSE</div>
</div>

<!-- -------------------- GAME OVER -------------------- -->
<div id="game-over">
  <h2>GAME OVER</h2>
  <p>Score: <span id="final-score">0</span></p>
  <button id="retry-btn">RETRY</button>
  <button id="menu-btn">MENU</button>
</div>

<script>
/* FULL GAME SCRIPT (Optimised + 90s Arcade Edition)
   ------------------------------------------------- 
   This contains:
   ‚Ä¢ moving clouds
   ‚Ä¢ retro snow per map
   ‚Ä¢ progressive difficulty
   ‚Ä¢ real audio system
   ‚Ä¢ store toggles (buy + equip)
   ‚Ä¢ reset + restore
   ‚Ä¢ hover start
*/

/* -------------- CANVAS SETUP -------------- */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* -------------- AUDIO SYSTEM -------------- */
let musicMenu = new Audio("music/arcade_menu.wav");
let musicRun = new Audio("music/arcade_run.wav");
let musicSnow = new Audio("music/blizzard_ambience.wav");
let musicNeon = new Audio("music/neon_map.wav");
let musicHard = new Audio("music/hard_mode.wav");

[musicMenu, musicRun, musicSnow, musicNeon, musicHard].forEach(m=>{
  m.loop = true;
  m.volume = 0.6;
});

let soundEnabled = true;

/* -------------- GAME VARIABLES -------------- */
let penguin = {
  x: 120,
  y: 200,
  v: 0
};

let gravity = 0.4;
let flap = -7;

let pipes = [];
let frames = 0;
let score = 0;

let running = false;
let hovering = true;

let bgMode = "normal";  // normal | blizzard | neon | hard

/* ------------------ STORE STATE ------------------ */
let unlock_noads = localStorage.getItem("noads") === "1";
let unlock_ulives = localStorage.getItem("ulives") === "1";
let unlock_hard = localStorage.getItem("hard") === "1";

/* update toggles */
function updateToggles(){
  document.getElementById("tog-noads").classList.toggle("active", unlock_noads);
  document.getElementById("tog-ulives").classList.toggle("active", unlock_ulives);
  document.getElementById("tog-hard").classList.toggle("active", unlock_hard);
}
updateToggles();

/* -------------- DRAW CLOUDS -------------- */
let clouds = [];
for(let i=0;i<7;i++){
  clouds.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height*0.5,
    s: Math.random()*1 + 0.5
  });
}

function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.7)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,40*c.s,20*c.s,0,0,Math.PI*2);
    ctx.fill();
    c.x -= 0.3*c.s;
    if(c.x < -100){
      c.x = canvas.width + 50;
      c.y = Math.random()*canvas.height*0.5;
    }
  });
}

/* -------------- SNOW (blizzard mode) -------------- */
let snow = [];
for(let i=0;i<120;i++){
  snow.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    s:Math.random()*2+1
  });
}

function drawSnow(){
  ctx.fillStyle="white";
  snow.forEach(s=>{
    ctx.fillRect(s.x,s.y,s.s,s.s);
    s.y+=s.s;
    if(s.y>canvas.height){
      s.y=-5;
      s.x=Math.random()*canvas.width;
    }
  });
}

/* -------------- DRAW BACKGROUND -------------- */
function drawBackground(){
  if(bgMode==="normal"){
    ctx.fillStyle="#6ecbff";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    drawClouds();
  }
  if(bgMode==="blizzard"){
    ctx.fillStyle="#b8c6d3";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    drawClouds();
    drawSnow();
  }
  if(bgMode==="neon"){
    let g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,"#ff00e6");
    g.addColorStop(1,"#0500ff");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }
  if(bgMode==="hard"){
    ctx.fillStyle="#330000";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    drawSnow();
  }
}

/* -------------- DRAW PENGUIN -------------- */
function drawPenguin(){
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(penguin.x, penguin.y, 18, 0, Math.PI*2);
  ctx.fill();
  ctx.fillStyle="orange";
  ctx.fillRect(penguin.x-5, penguin.y+12, 10,5);
}

/* -------------- PIPES -------------- */
function addPipe(){
  let gap = 180 - (score*0.3); // progressive difficulty
  if(gap<110) gap=110;

  let top = Math.random()*(canvas.height-gap-80)+40;

  pipes.push({
    x:canvas.width,
    top:top,
    gap:gap
  });
}

function drawPipes(){
  ctx.fillStyle="#00ff00";
  pipes.forEach(p=>{
    ctx.fillRect(p.x,0,60,p.top);
    ctx.fillRect(p.x,p.top+p.gap,60,canvas.height);
  });
}

/* -------------- GAME LOOP -------------- */
function loop(){
  if(!running) return;

  frames++;
  drawBackground();

  // pipes
  if(frames%90===0) addPipe();
  pipes.forEach(p=> p.x -= 3 + score*0.01);

  drawPipes();

  // penguin
  penguin.v += gravity;
  penguin.y += penguin.v;

  if(penguin.y > canvas.height-30) endGame();
  if(penguin.y < 20) penguin.y = 20;

  drawPenguin();

  // collisions
  pipes.forEach(p=>{
    if(p.x < penguin.x+18 && p.x+60 > penguin.x-18){
      if(penguin.y < p.top || penguin.y > p.top+p.gap){
        endGame();
      }
    }
    if(p.x+60 < penguin.x && !p.scored){
      p.scored=true;
      score++;
      document.getElementById("score").textContent = score;
    }
  });

  requestAnimationFrame(loop);
}

/* -------------- START GAME -------------- */
function startGame(){
  document.getElementById("main-menu").style.display="none";
  document.getElementById("score").textContent="0";

  // start music
  if(soundEnabled){
    musicMenu.pause();
    musicRun.currentTime=0;
    musicRun.play();
  }

  hovering=true;
  running=true;
  score=0;
  penguin.y=canvas.height/2;
  penguin.v=0;
  pipes=[];
  frames=0;

  drawBackground();
  drawPenguin();
}

/* ----------------- INPUT ----------------- */
canvas.addEventListener("mousedown", ()=>{
  if(!running) return;
  penguin.v = flap;
  hovering=false;
});

/* -------------- END GAME -------------- */
function endGame(){
  running=false;

  // music swap
  if(soundEnabled){
    musicRun.pause();
    musicMenu.currentTime=0;
    musicMenu.play();
  }

  document.getElementById("final-score").textContent = score;
  document.getElementById("game-over").style.display="flex";
}

/* -------------- UI BUTTONS -------------- */
document.getElementById("btn-play").onclick = ()=>{
  bgMode="normal";
  musicMenu.currentTime=0;
  if(soundEnabled) musicMenu.play();
  startGame();
};

document.getElementById("btn-store").onclick = ()=>{
  document.getElementById("store-panel").style.display="flex";
};

document.getElementById("close-store").onclick = ()=>{
  document.getElementById("store-panel").style.display="none";
};

/* --- Toggles (purchase + equip) --- */
function togglePurchase(id, variable){
  window[variable] = !window[variable];
  localStorage.setItem(id, window[variable] ? "1":"0");
  updateToggles();
}

document.getElementById("tog-noads").onclick = ()=> togglePurchase("noads","unlock_noads");
document.getElementById("tog-ulives").onclick = ()=> togglePurchase("ulives","unlock_ulives");
document.getElementById("tog-hard").onclick = ()=> togglePurchase("hard","unlock_hard");

document.getElementById("retry-btn").onclick = ()=>{
  document.getElementById("game-over").style.display="none";
  startGame();
};

document.getElementById("menu-btn").onclick = ()=>{
  document.getElementById("game-over").style.display="none";
  document.getElementById("main-menu").style.display="flex";
};

/* ----- Reset progress ----- */
document.getElementById("btn-reset").onclick = ()=>{
  localStorage.clear();
  alert("Progress reset.");
  unlock_noads=false;
  unlock_ulives=false;
  unlock_hard=false;
  updateToggles();
};

/* ----- Restore purchases (just re-loads toggles) ----- */
document.getElementById("btn-restore").onclick = ()=>{
  unlock_noads = localStorage.getItem("noads")==="1";
  unlock_ulives = localStorage.getItem("ulives")==="1";
  unlock_hard = localStorage.getItem("hard")==="1";
  updateToggles();
  alert("Purchases restored.");
};

/* ----- Sound toggle ----- */
document.getElementById("sound-btn").onclick = ()=>{
  soundEnabled = !soundEnabled;
  if(!soundEnabled){
    musicMenu.pause();
    musicRun.pause();
  } else {
    musicMenu.play();
  }
};

/* vibrate button placeholder */
document.getElementById("vibrate-btn").onclick = ()=>{
  if(navigator.vibrate) navigator.vibrate(100);
};
</script>
</body>
</html>
